var laya=function(){"use strict";var t,e=Laya.View,a=Laya.Scene,i=Laya.ClassUtils.regClass;!function(t){class s extends a{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("Loading")}}t.LoadingUI=s,i("ui.LoadingUI",s);class o extends e{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("Rocker")}}t.RockerUI=o,i("ui.RockerUI",o);class n extends a{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("UIMain")}}t.UIMainUI=n,i("ui.UIMainUI",n);class r extends a{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("Video")}}t.VideoUI=r,i("ui.VideoUI",r)}(t||(t={}));class s extends t.LoadingUI{constructor(){super(),this.progress=0,Laya.init(600,400,Laya.WebGL),Laya.stage.bgColor="#FFF",Laya.loader.load(["ui/progress_loading.png","ui/progress_loading$bar.png"],Laya.Handler.create(this,function(){this.pro=new Laya.ProgressBar("ui/progress_loading.png"),this.pro.width=400,this.pro.pos(60,150),this.pro.value=0,this.pro.sizeGrid="5,5,5,5",Laya.stage.addChild(this.pro),Laya.timer.loop(10,this,this.changeProgressBar)}))}changeProgressBar(){this.pro.value>=1&&(this.pro.value=0),this.pro.value+=.1*Math.random(),this.tips.text="正在加载中，请耐心等待："+Math.floor(100*this.pro.value)+" %"}showInfo(){this.tips.text="加载 0",this.tips.fontSize=15}}var o=Laya.Event;class n extends t.RockerUI{constructor(t){super(),this._MaxMoveDistance=10,this._curTouchId=-1,this._touchRect=t}onAwake(){this.joystickBg.on(o.MOUSE_DOWN,this,this._onMouseDown),this._touchRect.on(o.MOUSE_UP,this,this._onMouseUp),this._touchRect.on(o.MOUSE_OUT,this,this._onMouseUp),this._originPiontX=this.width/2,this._originPiontY=this.height/2,this._originPiont=new Laya.Point(this._originPiontX,this._originPiontY),this._joystickRadius=this._originPiontX-this.joystickPoint.width/2}_onMouseDown(t){this._curTouchId=t.touchId,this._startStageX=t.stageX,this._startStageY=t.stageY,this.joystickPoint.pos(this._originPiontX,this._originPiontY),this._touchRect.on(o.MOUSE_MOVE,this,this._onMouseMove),n._isTouchMove=!0}_onMouseMove(t){if(t.touchId!=this._curTouchId)return;let e=this.globalToLocal(new Laya.Point(Laya.stage.mouseX,Laya.stage.mouseY),!1);this.joystickPoint.pos(e.x,e.y),this._deltaX=e.x-this._originPiont.x,this._deltaY=e.y-this._originPiont.y;let a=this._deltaX*this._deltaX,i=this._deltaY*this._deltaY;if(n.angle=180*Math.atan2(this._deltaX,this._deltaY)/Math.PI,n.angle<0&&(n.angle+=360),n.angle=Math.round(n.angle),n.radians=Math.PI/180*n.angle,a+i>=this._joystickRadius*this._joystickRadius){let t=Math.floor(Math.sin(n.radians)*this._joystickRadius+this._originPiont.x),e=Math.floor(Math.cos(n.radians)*this._joystickRadius+this._originPiont.y);this.joystickPoint.pos(t,e)}else this.joystickPoint.pos(e.x,e.y)}_onMouseUp(t){t.touchId==this._curTouchId&&(this._touchRect.off(o.MOUSE_MOVE,this,this._onMouseMove),this.joystickPoint.pos(this._originPiontX,this._originPiontY),n.radians=n.angle=-1,n._isTouchMove=!1)}distanceSquare(t,e,a,i){return(a-t)*(a-t)+(i-e)*(i-e)}}n._isTouchMove=!1,n.angle=-1,n.radians=-1;class r extends t.UIMainUI{constructor(){super()}static initJoystick(){let t=new n(Laya.stage);Laya.stage.addChild(t),t.zOrder=9999,t.x=200,t.y=t.height-200,alert(1111)}}class h{constructor(){}}class d extends Laya.Script{constructor(){super()}onAwake(){this.videoOwner=this.owner}creatVideo(t){let e=Laya.Browser.createElement("div");e.className="div",this.divElement=e,Laya.Browser.document.body.appendChild(e);let a=new Laya.Size(this.videoOwner.width,this.videoOwner.height);Laya.Utils.fitDOMElementInArea(e,this.videoOwner,0,0,a.width,a.height);let i=Laya.Browser.createElement("video");i.setAttribute("id","myvideo"),this.videoElement=i,i.controls=!0,i.setAttribute("webkit-playsinline",!0),i.setAttribute("playsinline",!0),i.setAttribute("x5-video-player-type","h5"),i.setAttribute("x-webkit-airplay",!0),i.setAttribute("x5-video-orientation","portrait"),i.setAttribute("preload","auto"),i.setAttribute("width","100%"),i.setAttribute("height","100%"),i.setAttribute("autoplay","true"),i.style.zInddex=Laya.Render.canvas.style.zIndex+1,i.type="vedio/mp4",i.src=t,e.appendChild(i)}playVideo(t){null!=this.videoElement&&(this.videoElement.pause(),this.videoElement.src=t,this.videoElement.play())}videoEvent(){this.videoElement.addEventListener("loadstart",()=>{}),this.videoElement.addEventListener("progress",()=>{}),this.videoElement.addEventListener("play",()=>{}),this.videoElement.addEventListener("pause",()=>{}),this.videoElement.addEventListener("seeking",()=>{}),this.videoElement.addEventListener("seeked",()=>{}),this.videoElement.addEventListener("waiting",()=>{}),this.videoElement.addEventListener("timeupdate",()=>{}),this.videoElement.addEventListener("ended",()=>{}),this.videoElement.addEventListener("error",()=>{})}myClear(){console.log(Laya.Browser.document.body.hasChildNodes(this.divElement)),null!=this.divElement&&Laya.Browser.document.body.hasChildNodes(this.divElement)&&Laya.Browser.document.body.removeChild(this.divElement),h.isClickVideoBtn=!1}}class l extends t.VideoUI{constructor(){super()}onAwake(){console.log(this),this.width=Laya.stage.width,this.videoWin.pos((Laya.stage.width-this.videoWin.width)/2,this.videoWin.y),this.btn_close.pos((Laya.stage.width-this.videoWin.width)/2+this.videoWin.width,this.videoWin.y),this.btn_close.on(Laya.Event.MOUSE_DOWN,this,this.onCloseClick),this.videoWin.x=this.width/2-this.videoWin.width/2,this.videoWin.y=this.height/2-this.videoWin.height/2,console.log("videoWin.x",this.videoWin.x),console.log("videoWin.y",this.videoWin.y),this.videoCtl=this.videoWin.addComponent(d),this.videoBg.pos(0,0),this.videoBg.size(Laya.stage.width,Laya.stage.height),this.videoBg.graphics.drawRect(0,0,this.videoBg.width,this.videoBg.height,"rgba(0,0,0,.4)"),this.videoBg.on(Laya.Event.MOUSE_DOWN,this,this.mouseHandler)}mouseHandler(){h.isClickVideoBtn=!0}createVideo(t){this.videoCtl.creatVideo(t)}createVideos(t){this._urls=t,this._currentPlayIndex=0,this.videoCtl.creatVideo(t[0])}onCloseClick(){h.isClickVideoBtn=!0,null!=this.videoCtl&&this.videoCtl.myClear(),this.destroy(),this.videoCtl=null}}class c{constructor(){}static init(){var t=Laya.ClassUtils.regClass;t("script/LoadingUI.ts",s),t("script/RockerUI.ts",n),t("script/UIMainUI.ts",r),t("script/VideoUI.ts",l)}}c.width=640,c.height=1136,c.scaleMode="fixedwidth",c.screenMode="horizontal",c.alignV="top",c.alignH="left",c.startScene="Loading.scene",c.sceneRoot="",c.debug=!1,c.stat=!1,c.physicsDebug=!1,c.exportSceneToJson=!0,c.init();class y extends Laya.Script3D{constructor(){super(),this._MaxMoveDistance=10,this._tempVector3=new Laya.Vector3,this.yawPitchRoll=new Laya.Vector3,this.resultRotation=new Laya.Quaternion,this.tempRotationZ=new Laya.Quaternion,this.tempRotationX=new Laya.Quaternion,this.tempRotationY=new Laya.Quaternion,this.rotaionSpeed=1e-4,this.lastMouseX=0,this.lastMouseY=0,this.isMouseDown=!1,this.moveSpeed=2,this.posX=0,this.posY=0,this.point=new Laya.Vector2,this._outHitResult=new Laya.HitResult,this.outs=new Laya.HitResult,this.ray=new Laya.Ray(new Laya.Vector3(0,0,0),new Laya.Vector3(0,-2,0)),this.outHitInfo=new Laya.HitResult,this._ray=new Laya.Ray(new Laya.Vector3(0,0,0),new Laya.Vector3(0,0,0))}onAwake(){Laya.stage.on(Laya.Event.MOUSE_DOWN,this,this.mouseDown),Laya.stage.on(Laya.Event.MOUSE_MOVE,this,this.mouseMove),Laya.stage.on(Laya.Event.MOUSE_UP,this,this.mouseUp),this.camera=this.owner}_onDestroy(){Laya.stage.off(Laya.Event.MOUSE_DOWN,this,this.mouseDown),Laya.stage.off(Laya.Event.MOUSE_UP,this,this.mouseUp)}onUpdate(){var t=Laya.timer.delta;if(-1!=n.angle){var e=Math.sin(n.radians),a=Math.cos(n.radians);this.moveForward(this.moveSpeed*t*.001*a),this.moveRight(this.moveSpeed*t*.001*e);var i=e-10,s=a-10,o=e>0?1:-1,r=a>0?1:-1;h.isTrigger&&(console.log(h.isTrigger),this.moveForward(this.moveSpeed*t*.001*s*r),this.moveRight(this.moveSpeed*t*.001*i*o));var d=new Laya.Vector3(0,0,0);Laya.Vector3.add(this.camera.transform.position,new Laya.Vector3(e,0,a),d),this.ray.origin=d,this.camera.parent.scene.physicsSimulation.rayCast(this.ray,this.outHitInfo),this.outHitInfo.succeeded||(e=a=0,h.cameraTranslate=new Laya.Vector3(e,0,a))}else if(isNaN(this.lastMouseX)||isNaN(this.lastMouseY)||!this.isMouseDown||n._isTouchMove||h.isClickVideoBtn)Laya.KeyBoardManager.hasKeyDown(87)&&(h.isTrigger&&this.moveForward(.001*t+1),this.moveForward(-.001*t)),Laya.KeyBoardManager.hasKeyDown(83)&&(h.isTrigger&&this.moveForward(-.001*t-1),this.moveForward(.001*t)),Laya.KeyBoardManager.hasKeyDown(65)&&(h.isTrigger&&this.moveRight(.001*t+1),this.moveRight(-.001*t)),Laya.KeyBoardManager.hasKeyDown(68)&&(h.isTrigger&&this.moveRight(-.001*t-1),this.moveRight(.001*t)),h.cameraTranslate=new Laya.Vector3(0,0,0),h.cameraRotate=new Laya.Vector3(0,0,0);else{this.posX=this.point.x=Laya.MouseManager.instance.mouseX,this.posY=this.point.y=Laya.MouseManager.instance.mouseY,this.camera.viewportPointToRay(this.point,this._ray),this.camera.parent.scene.physicsSimulation.rayCast(this._ray,this.outs);var l=Laya.stage.mouseX-this.lastMouseX,c=Laya.stage.mouseY-this.lastMouseY,y=this.yawPitchRoll;y.x+=l*this.rotaionSpeed*t,y.y+=c*this.rotaionSpeed*t,this.updateRotation(),this.lastMouseX=Laya.stage.mouseX,this.lastMouseY=Laya.stage.mouseY}}mouseDown(t){this.camera.transform.localRotation.getYawPitchRoll(this.yawPitchRoll),this.lastMouseX=Laya.stage.mouseX,this.lastMouseY=Laya.stage.mouseY,this._startStageX=t.stageX,this._startStageY=t.stageY,this.isMouseDown=!0,this.touchMove=!1}mouseUp(t){this.isMouseDown=!1}mouseMove(t){let e=this.distanceSquare(this._startStageX,this._startStageY,t.stageX,t.stageY);this.touchMove=e>0}moveForward(t){this._tempVector3.x=0,this._tempVector3.y=0,this._tempVector3.z=t,this.camera.transform.translate(this._tempVector3)}moveRight(t){this._tempVector3.y=0,this._tempVector3.z=0,this._tempVector3.x=t,this.camera.transform.translate(this._tempVector3)}moveVertical(t){this._tempVector3.x=this._tempVector3.z=0,this.camera.transform.translate(this._tempVector3,!1)}updateRotation(){Math.abs(this.yawPitchRoll.y)<.5&&(Laya.Quaternion.createFromYawPitchRoll(this.yawPitchRoll.x,this.yawPitchRoll.y,this.yawPitchRoll.z,this.tempRotationZ),this.tempRotationZ.cloneTo(this.camera.transform.localRotation),this.camera.transform.localRotation=this.camera.transform.localRotation)}onEnable(){}onDisable(){}distanceSquare(t,e,a,i){return(a-t)*(a-t)+(i-e)*(i-e)}}class u extends Laya.Script3D{constructor(){super(),this._dir=new Laya.Vector3,this._rotateUpDir=new Laya.Vector3(0,0,0),this.lookAtRotation=new Laya.Quaternion(0,0,0,0)}init(t,e){this.isOpposite=e,this.target=t}onStart(){this.monkey=this.owner}onUpdate(){null!==this.target&&(this._dir.x=this.target.transform.position.x-this.monkey.transform.position.x,this._dir.y=0,this._dir.z=this.target.transform.position.z-this.monkey.transform.position.z,this.isOpposite&&(this._dir.x*=-1,this._dir.z*=-1),this._dir.z*=-1,Laya.Quaternion.rotationLookAt(this._dir,this._rotateUpDir,this.lookAtRotation),this.monkey.transform.rotation=this.lookAtRotation)}}class g extends Laya.Script3D{constructor(){super(),this.currentName="",console.log("triggerScript")}onTriggerEnter(t){console.log("enter:"+t.owner.name),"qiang"==t.owner.name||t.owner.name,h.isTrigger=!1}onTriggerExit(t){console.log("exit:"+t.owner.name),"qiang"==t.owner.name||"qiangbianshang"==t.owner.name?h.isTrigger=!0:h.isTrigger=!1}}class m{constructor(){this.posX=0,this.posY=0,this.point=new Laya.Vector2,this._outHitResult=new Laya.HitResult,this.outs=new Array,this._tempVector3=new Laya.Vector3,Config.useRetinalCanvas=!0,Config.isAntialias=!0,Config.isAlpha=!0,window.Laya3D?Laya3D.init(c.width,c.height):Laya.init(c.width,c.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=c.scaleMode,Laya.stage.screenMode=c.screenMode,Laya.stage.alignV=c.alignV,Laya.stage.alignH=c.alignH,Laya.URL.exportSceneToJson=c.exportSceneToJson,(c.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),c.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),c.stat&&Laya.Stat.show(),Laya.alertGlobalError(!0),Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION),Laya.stage.screenMode="horizontal",Laya.stage.bgColor=null,h.cameraTranslate=new Laya.Vector3,h.cameraRotate=new Laya.Vector3,h.turnSpeed=0,h.isClickVideoBtn=!1,this._ray=new Laya.Ray(new Laya.Vector3(0,0,0),new Laya.Vector3(0,0,0))}onVersionLoaded(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))}onConfigLoaded(){c.startScene&&Laya.Scene.open(c.startScene),this.PreloadingRes()}PreloadingRes(){Laya.loader.create(["res/LayaScene_changjing/Conventional/changjing.ls","res/atlas/kefu2d.png","res/atlas/play.png"],Laya.Handler.create(this,this.on3DComplete))}on3DComplete(){this.scene=Laya.stage.addChild(Laya.Loader.getRes("res/LayaScene_changjing/Conventional/changjing.ls")),console.log(this.scene),this.scene.ambientColor=new Laya.Vector3(.6,0,0),this.camera=this.scene.getChildByName("Main Camera"),this.camera.enableHDR=!1,this.camera.addComponent(y),this.camera.addComponent(g),this.scene.addChild(this.camera),this.scene.physicsSimulation.continuousCollisionDetection=!0,h.video=new l,m.rocker=new n(Laya.stage),Laya.stage.addChild(m.rocker),m.rocker.x=25,m.rocker.y=Laya.stage.height-120;var t=new Laya.UnlitMaterial;t.albedoTexture=Laya.Loader.getRes("res/atlas/kefu2d.png"),t.albedoIntensity=1,t.alphaTest=!0,t.alphaTestValue=.6,t.renderQueue=Laya.Material.RENDERQUEUE_ALPHATEST;var e=this.scene.addChild(new Laya.MeshSprite3D(Laya.PrimitiveMesh.createQuad(.6,1.7)));e.transform.translate(new Laya.Vector3(-1,1,2.3)),e.meshRenderer.material=t,e.addComponent(u).init(this.camera,!1);var a=new Laya.UnlitMaterial;a.albedoTexture=Laya.Loader.getRes("res/atlas/play.png"),a.albedoIntensity=1,a.alphaTest=!0,a.alphaTestValue=.6,a.renderQueue=Laya.Material.RENDERQUEUE_ALPHATEST;var i=this.scene.addChild(new Laya.MeshSprite3D(Laya.PrimitiveMesh.createQuad(.6,.6)));i.transform.translate(new Laya.Vector3(.1,1.8,-2.8)),i.meshRenderer.material=a;var s=i.addComponent(Laya.PhysicsCollider),o=new Laya.BoxColliderShape(1,0,1);s.colliderShape=o,s.friction=2,s.restitution=.3,s.owner.name="videoBtn",i.addComponent(u).init(this.camera,!1),this.addMouseEvent(),Laya.timer.frameLoop(100,this,this.onFrameLoop)}addMouseEvent(){Laya.stage.on(Laya.Event.MOUSE_DOWN,this,this.onMouseDown)}onMouseDown(){n._isTouchMove||(this.posX=this.point.x=Laya.MouseManager.instance.mouseX,this.posY=this.point.y=Laya.MouseManager.instance.mouseY,this.camera.viewportPointToRay(this.point,this._ray),this.scene.physicsSimulation.rayCastAll(this._ray,this.outs),0!==this.outs.length&&this.outs.forEach((t,e)=>{if("videoBtn"==t.collider.owner.name&&!h.isClickVideoBtn){h.video=new l,Laya.stage.addChild(h.video);let t="https://2dhall-video.ciftis.org/trans-video/20200813/08b05b19efc64b498ca7124746505234.mp4";h.video.createVideo(t),h.isClickVideoBtn=!0}}))}moveForward(t){this._tempVector3.x=0,this._tempVector3.z=t,this.camera.transform.translate(this._tempVector3)}moveRight(t){this._tempVector3.z=0,this._tempVector3.x=t,this.camera.transform.translate(this._tempVector3)}addButton(t,e,a,i,s,o,n){Laya.loader.load(["res/threeDimen/ui/button.png"],Laya.Handler.create(this,function(){this.changeActionButton=Laya.stage.addChild(new Laya.Button("res/threeDimen/ui/button.png",s)),this.changeActionButton.size(a,i),this.changeActionButton.labelBold=!0,this.changeActionButton.labelSize=10,this.changeActionButton.sizeGrid="4,4,4,4",this.changeActionButton.scale(Laya.Browser.pixelRatio,Laya.Browser.pixelRatio),this.changeActionButton.pos(t,e),this.changeActionButton.on(Laya.Event.MOUSE_DOWN,this,o),this.changeActionButton.on(Laya.Event.MOUSE_UP,this,n)}))}onFrameLoop(){this.camera.transform.translate(h.cameraTranslate,!1),this.camera.transform.rotate(h.cameraRotate,!0,!1)}}return new m,m}();